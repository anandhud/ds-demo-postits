<html lang="en"><head>
	<meta charset="UTF-8">
	<title>PostIt Board</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Reenie+Beanie' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Permanent+Marker' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="src/css/reset.css" type="text/css" media="all">	
	<link rel="stylesheet" href="src/css/tutorial.css" type="text/css" media="all">	
	<link rel="stylesheet" href="src/css/postit.css" type="text/css" media="all">	
	<link rel="stylesheet" href="src/css/app.css" type="text/css" media="all">

	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
	<script type="text/javascript" src="https://rawgit.com/hoxton-one/deepstream.io-client-js/master/dist/deepstream.min.js"></script>

	<script type="text/javascript" src="src/js/tutorial.js"></script>
	<script type="text/javascript" src="src/js/postit.js"></script>
	<script type="text/javascript" src="src/js/postit-board.js"></script>
	<script type="text/javascript" src="src/js/app.js"></script>

	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/tomorrow-night.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>

<body>

	<div class="header">
		<span class="menu-button lines-button x">
			<span class="lines"></span>
		</span>
		<span class="header-title">
			RETROSPECTIVE WHITEBOARD
		</span>
	</div>

	<div class="board">
	</div>

	<div class="add-sticky-notes-wrapper">
		<span class="add-sticky-notes">
			<div class="sticky-note small-sticky-note" data-type="happy">
				<div class="sticky-note-header">
				</div>
				<div class="sticky-note-inner">
					GLAD
				</div>
			</div>

			<div class="sticky-note small-sticky-note" data-type="sad">
				<div class="sticky-note-header">
				</div>
				<div class="sticky-note-inner">
					SAD
				</div>
			</div>

			<div class="sticky-note small-sticky-note" data-type="mad">
				<div class="sticky-note-header">
				</div>
				<div class="sticky-note-inner">
					MAD
				</div>
			</div>
		</span>
	</div>

	<ul class="menu">
		<li class="menu-item selected" data-value="tut-server">
			Server
		</li>
		<li class="menu-item" data-value="tut-login">
			Login
		</li>
		<li class="menu-item" data-value="tut-creating-record">
			Creating Record
		</li>
		<li class="menu-item" data-value="tut-adding-to-list">
			Adding to list
		</li>
		<li class="menu-item" data-value="tut-listening-to-list">
			Listening to list
		</li>		
		<li class="menu-item" data-value="tut-updating-record">
			Updating record
		</li>		
		<li class="menu-item" data-value="tut-listening-to-record">
			Listening to record
		</li>
		<li class="menu-item" data-value="tut-deleting-record">
			Removing record
		</li>
	</ul>

	<div class="shield">
		<pre class="tut" id="tut-server">
			<code class="javascript">
var DeepstreamServer = require( 'deepstream.io' ),
server = new DeepstreamServer();
server.set( 'host', 'localhost' );
server.set( 'port', 6020 );
server.start();
			</code>
		</pre>
		<pre class="tut" id="tut-login">
			<code class="javascript">
var ds = deepstream( '192.168.0.201:6020' );
ds.login( {}, function( success, errorEvent, errorMessage ) {
	if( success ) {
		new PostitBoard( ds );	
	} else {
		alert( 'Fail to login.' );
	}		
} );
			</code>
		</pre>
<pre class="tut" id="tut-creating-record">
	<code class="javascript">
var newPostitID = this.ds.getUid();
var newPostit = this.ds.record.getRecord( newPostitID );
newPostit.set( {
	type: 'happy',
	content: '',
	position: {
		top: x,
		left: y
	}
} );
	</code>
</pre>
<pre class="tut" id="tut-adding-to-list">
	<code class="javascript">
this.stickyList = this.ds.record.getList( 'room/postits' );
this.stickyList.addEntry( newPostitID );
	</code>
</pre>
<pre class="tut" id="tut-listening-to-list" >
	<code class="javascript">
this.stickyList = this.ds.record.getList( 'room/postits' );
this.stickyList.subscribe( this.onPostitsChanged.bind( this ) );
this.stickyList.whenReady( this.onPostitsChanged.bind( this ) );

PostitBoard.prototype.onPostitsChanged = function() {
	var postit;
	var record;

	this.stickyList.subscribe( function() {
		entries = this.stickyList.getEntries();
		for( var i=0; i < entries.length; i++ ) {
			if( this.existingEntries.indexOf( entries[ i ] ) === -1 ) {
				this.existingEntries.push( entries[ i ] );

				record = this.ds.record.getRecord( entries[ i ] );
				record.whenReady( function( record ) {
					postit = new Postit( record, this.isDesktop  );
					this.board.append( postit.getElement());
				}.bind( this ) );
			}
		}
	}.bind( this ) );
};
	</code>
</pre>
<pre class="tut" id="tut-updating-record">
	<code class="javascript">
textArea.keyup( function() {
	record.set( 'content', textArea.val() );
});

function drag( event, ui ) {	
	record.set( 'position', {
		top: ui.position.top,
		left: ui.position.left
	} ); 		
}
	</code>
</pre>
<pre class="tut" id="tut-listening-to-record">
	<code class="javascript">
record.subscribe( 'content', function( value ) {
	textArea.val( value );
}, true );

record.subscribe( 'position', function( position ) {
	element.css( {
		left: position.left,
		top: position.top
	} );	
}, true );
	</code>
</pre>
<pre class="tut" id="tut-deleting-record">
	<code class="javascript">
list.removeEntry( record.name );
record.delete();
	</code>
</pre>
	</div>

</body>

</html>